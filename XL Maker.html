<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Entry and Export</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .controls { margin-bottom: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 5px; background-color: #f9f9f9; }
        .controls label { display: block; margin-bottom: 5px; font-weight: bold; }
        .controls input[type="number"] { width: 60px; padding: 5px; margin-right: 20px; }
        .table-container { margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; cursor: pointer; }
        input[type="text"] { width: calc(100% - 10px); box-sizing: border-box; border: none; padding: 4px; }
        .button-group button { padding: 10px 15px; margin-right: 10px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        #generateTable { background-color: #4CAF50; color: white; }
        #exportCSV { background-color: #008CBA; color: white; }
        #exportPDF { background-color: #f44336; color: white; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
</head>
<body>

    <div class="controls">
        <label for="numColumns">Number of Columns (N):</label>
        <input type="number" id="numColumns" value="3" min="1">

        <label for="numRows">Number of Rows (N):</label>
        <input type="number" id="numRows" value="5" min="1">
        
        <button id="generateTable" onclick="generateDataEntryTable()">Generate Table</button>
    </div>

    <div class="button-group">
        <button id="exportCSV" onclick="exportData('csv')" disabled>Export to CSV (Excel-Compatible)</button>
        <button id="exportPDF" onclick="exportData('pdf')" disabled>Export to PDF</button>
    </div>

    <div class="table-container">
        <table id="dataTable"></table>
    </div>

    <script>
        const table = document.getElementById('dataTable');
        const numColsInput = document.getElementById('numColumns');
        const numRowsInput = document.getElementById('numRows');
        const exportCSVBtn = document.getElementById('exportCSV');
        const exportPDFBtn = document.getElementById('exportPDF');
        
        // Initial table generation on load
        document.addEventListener('DOMContentLoaded', generateDataEntryTable);


        // --- STEP 1: Generate the Data Entry Table ---
        function generateDataEntryTable() {
            const numCols = parseInt(numColsInput.value) || 1;
            const numRows = parseInt(numRowsInput.value) || 1;

            if (numCols < 1 || numRows < 1) {
                alert("Please enter positive values for rows and columns.");
                return;
            }

            table.innerHTML = ''; // Clear existing table

            // 1. Create Header Row (for Dropdown Titles)
            let thead = table.createTHead();
            let headerRow = thead.insertRow();

            for (let i = 0; i < numCols; i++) {
                let th = document.createElement('th');
                // The header itself is a data entry field (acting as your 'Dropdown Title')
                th.innerHTML = `<input type="text" value="Column ${i + 1}" class="header-input" placeholder="Column Title ${i + 1}">`;
                headerRow.appendChild(th);
            }

            // 2. Create Data Rows
            let tbody = table.createTBody();
            for (let i = 0; i < numRows; i++) {
                let row = tbody.insertRow();
                for (let j = 0; j < numCols; j++) {
                    let cell = row.insertCell();
                    // Each cell is a data entry field
                    cell.innerHTML = `<input type="text" value="" class="data-input" placeholder="R${i + 1}C${j + 1}">`;
                }
            }

            // Enable export buttons
            exportCSVBtn.disabled = false;
            exportPDFBtn.disabled = false;
        }

        // --- STEP 2: Collect Data from the Table ---
        function collectTableData() {
            const data = [];
            const headerRow = table.querySelector('thead tr');
            const dataRows = table.querySelectorAll('tbody tr');

            if (!headerRow) return null;

            // Collect Headers (Titles)
            const headers = Array.from(headerRow.querySelectorAll('input.header-input')).map(input => input.value);
            data.push(headers);

            // Collect Row Data
            dataRows.forEach(row => {
                const rowData = Array.from(row.querySelectorAll('input.data-input')).map(input => input.value);
                data.push(rowData);
            });

            return data;
        }


        // --- STEP 3: Export Logic ---
        function exportData(format) {
            const data = collectTableData();
            if (!data) return;

            if (format === 'csv') {
                exportToCSV(data);
            } else if (format === 'pdf') {
                exportToPDF(data);
            }
        }

        // --- EXPORT TO CSV (Excel-Compatible) ---
        function exportToCSV(data) {
            // Converts the array of arrays into a CSV string.
            // Quotes are used for cells that contain commas to handle data integrity.
            const csvContent = data.map(row => 
                row.map(cell => `"${cell.replace(/"/g, '""')}"`).join(',')
            ).join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'data_export.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- EXPORT TO PDF ---
        function exportToPDF(data) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Separate headers from the rest of the data
            const headers = [data[0]]; // AutoTable expects headers as an array of arrays
            const body = data.slice(1);

            // Use the AutoTable plugin
            doc.autoTable({
                head: headers,
                body: body,
                startY: 10,
                theme: 'grid',
                styles: { 
                    fontSize: 10, 
                    cellPadding: 3 
                },
                headStyles: { 
                    fillColor: [200, 200, 200], 
                    textColor: [0, 0, 0], 
                    fontStyle: 'bold' 
                }
            });

            doc.save('data_export.pdf');
        }
    </script>

</body>
</html>
