<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <title>LAN Exam - One Question at a Time</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --primary:#2563eb; --primary-600:#1d4ed8; --bg:#f7f7fb; --card:#ffffff;
      --text:#1f2937; --muted:#6b7280; --success:#16a34a; --danger:#dc2626; --warn:#d97706;
    }
    * { box-sizing:border-box }
    body {
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:var(--bg); color:var(--text);
      display:flex; align-items:center; justify-content:center; min-height:100vh; padding:16px;
    }
    .app {
      width:100%; max-width:900px; background:var(--card); border-radius:14px;
      box-shadow:0 10px 30px rgba(0,0,0,.08); overflow:hidden;
    }
    header {
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding:14px 18px; background:#eef2ff; border-bottom:1px solid #e5e7eb;
      flex-wrap:wrap;
    }
    .brand { font-weight:700; color:#111827 }
    .meta { display:flex; gap:14px; align-items:center; flex-wrap:wrap; }
    .pill { padding:6px 10px; border-radius:999px; background:#fff; border:1px solid #e5e7eb; font-size:14px; color:#374151 }
    .timer { color:var(--warn); font-weight:600 }
    .content { padding:18px; }
    .q-header { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:10px; }
    .progress-wrap { width:100%; background:#eef2ff; height:8px; border-radius:999px; overflow:hidden }
    .progress { height:100%; background:var(--primary); width:0% }
    .question-card {
      background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:16px; margin-top:14px;
    }
    .q-text { font-size:18px; line-height:1.5; margin-bottom:12px; }
    .options { display:grid; gap:10px; }
    .opt {
      padding:12px 14px; border:2px solid #e5e7eb; border-radius:10px; cursor:pointer; background:#fff;
      display:flex; gap:10px; align-items:flex-start; transition:.15s ease;
    }
    .opt:hover { border-color:#c7d2fe; background:#f8fafc }
    .opt.selected { border-color:var(--primary); background:#eff6ff }
    .opt.correct { border-color:var(--success); background:#ecfdf5 }
    .opt.wrong { border-color:var(--danger); background:#fef2f2 }
    .opt input { margin-top:3px }
    .Nav {
      display:flex; gap:10px; justify-content:space-between; margin-top:16px; flex-wrap:wrap;
    }
    .left, .right { display:flex; gap:10px }
    button {
      padding:10px 14px; border-radius:10px; border:1px solid #d1d5db; background:#fff; cursor:pointer; color:#111827;
    }
    .btn { background:var(--primary); color:#fff; border-color:var(--primary); }
    .btn:hover { background:var(--primary-600); }
    .ghost { background:#fff; }
    .muted { color:var(--muted); }
    .footer { padding:14px 18px; border-top:1px solid #e5e7eb; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:8px; }
    .review { margin-top:16px; border-top:1px dashed #e5e7eb; padding-top:12px; }
    .badge { font-size:12px; padding:4px 8px; border-radius:999px; background:#f3f4f6; color:#374151; border:1px solid #e5e7eb; }
    .hidden { display:none !important }
    .score { font-weight:700; color:var(--success) }
    .warning { color:var(--warn) }
    .danger { color:var(--danger) }
    .success { color:var(--success) }
    @media (max-width:600px){ .meta{width:100%} }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div class="brand">EDUTERIA Current Affairs Practice Set 01</div>
      <div class="meta">
        <span class="pill">Mode: Offline</span>
        <span class="pill">Questions: <span id="totalCount">0</span></span>
        <span class="pill timer" id="timerPill">Timer: Off</span>
      </div>
    </header>

    <div class="content">
      <div class="q-header">
        <div id="qIndex" class="muted">प्रश्न 1</div>
        <div class="progress-wrap" aria-label="progress">
          <div class="progress" id="progress"></div>
        </div>
      </div>

      <div class="question-card" id="qCard">
        <div class="q-text" id="qText"></div>
        <div class="options" id="options"></div>

        <div class="review hidden" id="review">
          <div><span class="badge">सही उत्तर</span> <span id="correctText"></span></div>
        </div>

        <div class="Nav">
          <div class="left">
            <button id="btnPrev" class="ghost">Previous</button>
            <button id="btnClear" class="ghost">Clear</button>
          </div>
          <div class="right">
            <button id="btnSave" class="ghost">Save</button>
            <button id="btnNext" class="btn">Next</button>
          </div>
        </div>
      </div>

      <div id="resultCard" class="question-card hidden">
        <div style="font-size:20px; margin-bottom:8px;">परिणाम</div>
        <div>Score: <span class="score" id="finalScore"></span></div>
        <div class="muted" id="summaryLine"></div>
        <div class="review" id="reviewList"></div>
        <div class="Nav">
          <div class="left">
            <button id="btnRestart" class="ghost">Restart</button>
            <button id="btnDownload" class="ghost">Download CSV</button>
          </div>
          <div class="right">
            <button id="btnRetake" class="btn">Retake</button>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">
      <div class="muted">One-question-at-a-time exam. Auto-grades with embedded answer key.</div>
      <div>
        <label class="muted" style="margin-right:8px;">
          <input type="checkbox" id="toggleTimer" /> Enable 30m Timer
        </label>
        <label class="muted">
          <input type="checkbox" id="toggleShuffle" /> Shuffle questions
        </label>
      </div>
    </div>
  </div>

  <script>
    // Config
    const config = {
      shuffleQuestions: false,
      timerMinutes: 30
    };

    // Questions (from attached PDF) and Answer Key mapping (1..50)
    // Format: { q: "text", opts: ["A) ...","B) ...","C) ...","D) ..."], ans: "A" }
    const QA = [
      {q:"1. किनकी 300वीं जयंती पर 300 रुपये का स्मारक सिक्का और डाक टिकट जारी किया गया?", opts:["A) गुरू रामदास","B) देवी अहिल्याबाई होल्कर","C) छत्रपति शिवाजी महाराज","D) पंडिता रमाबाई"], ans:"B"},
      {q:"2. मई 2025 में 'उल्लास-नवभारत साक्षरता कार्यक्रम' के तहत किस राज्य ने खुद को पूर्ण साक्षर राज्य घोषित किया?", opts:["A) केरल","B) मेघालय","C) गोवा","D) तमिलनाडु"], ans:"C"},
      {q:"3. भारतीय भाषाओं के लिए भारत का पहला स्वदेशी AI आधारित मल्टीमॉडल LLM का नाम?", opts:["A) भारत भाषा","B) भारत जन","C) भारत बोली","D) भारत जेन"], ans:"D"},
      {q:"4. किस वन्यजीव अभ्यारण्य को इको-सेंसिटिव जोन घोषित किया?", opts:["A) त्रिकुटा","B) त्राल","C) नंदिनी","D) गुलमर्ग"], ans:"B"},
      {q:"5. जनगणना 2027 (जातिगत गणना सहित) कितने चरणों में?", opts:["A) 2","B) 3","C) 4","D) 5"], ans:"A"},
      {q:"6. RBI ने 2025-26 के लिए GDP वृद्धि का अनुमान?", opts:["A) 6.1%","B) 6.4%","C) 6.5%","D) 6.8%"], ans:"C"},
      {q:"7. भारत के पहले मानवयुक्त गहरे समुद्र मिशन के बारे में सत्य कथन चुनें:", opts:["A) केवल 1 और 2","B) केवल 2 और 4","C) केवल 2 और 3","D) उपर्युक्त में से कोई नहीं"], ans:"C"},
      {q:"8. इंडिया जस्टिस रिपोर्ट 2025 पर असत्य कथन चुनें:", opts:["A) ...टाटा ट्रस्ट द्वारा जारी","B) ...पुलिस-जनसंख्या 155/1,00,000","C) ...8% महिला अधिकारी वरिष्ठ पदों पर","D) ...न्यायपालिका में 15/10 लाख, वांछित 50"], ans:"D"},
      {q:"9. असम-मेघालय की 55 MW जलविद्युत सिंचाई परियोजना किस सहायक नदी पर?", opts:["A) लोहित","B) संकोश","C) कांमेंग","D) कुल्सी"], ans:"D"},
      {q:"10. दुनिया के सबसे ऊँचे रेलवे आर्च ब्रिज किस नदी पर?", opts:["A) व्यास","B) रावी","C) चिनाब","D) सतलुज"], ans:"C"},
      {q:"11. विश्व स्वास्थ्य दिवस 2025 कथनों में कौन सही?", opts:["A) केवल 1","B) केवल 2","C) दोनों","D) दोनों गलत"], ans:"C"},
      {q:"12. मोढेरा में 20,000 बार सूर्य नमस्कार का विश्व रिकॉर्ड किसने?", opts:["A) विशाल सिंह","B) ज्योति कुमारी","C) संदीप आर्य","D) अंशु त्रिपाठी"], ans:"C"},
      {q:"13. भारत के शहरी बुनियादी ढाँचे हेतु 10 अरब डॉलर निवेश की घोषणा किस बैंक ने?", opts:["A) एशियाई विकास बैंक","B) विश्व बैंक","C) बैंक ऑफ अमेरिका","D) बैंक ऑफ चाइना"], ans:"A"},
      {q:"14. किस राज्य का स्थल आधिकारिक तौर पर रामसर घोषित?", opts:["A) बिहार","B) तमिलनाडु","C) आन्ध्र प्रदेश","D) कर्नाटक"], ans:"D"},
      {q:"15. भारत की 'लेक राजधानी' बना महानगर?", opts:["A) पटना","B) अहमदाबाद","C) पुणे","D) बेंगलुरु"], ans:"D"},
      {q:"16. दुनिया की पहली एम्फीबियन सूची का नाम?", opts:["A) Green List","B) Blue List","C) Red List","D) Game List"], ans:"B"},
      {q:"17. विश्व बैंक रिपोर्ट: गरीबी 2011-12 में 25% से घटकर?", opts:["A) 4.8%","B) 5.1%","C) 5.3%","D) 5.5%"], ans:"C"},
      {q:"18. RBI से NBFC लाइसेंस पाने वाली पहली भारतीय ई-कॉमर्स कंपनी?", opts:["A) मिंत्रा","B) स्नैपडील","C) अमेजन","D) फ्लिपकार्ट"], ans:"D"},
      {q:"19. पहली कक्षा के विद्यार्थियों हेतु संख्या सुधार शुरू करने वाला राज्य?", opts:["A) महाराष्ट्र","B) सिक्किम","C) पंजाब","D) राजस्थान"], ans:"A"},
      {q:"20. ईरान के चाबहार में किस ऑपरेशन की शुरुआत?", opts:["A) ऑपरेशन दोस्त","B) ऑपरेशन सिंधु","C) ऑपरेशन मैत्री","D) ऑपरेशन गंगा"], ans:"B"},
      {q:"21. 'माउंट पेनी' (पैडी) GI टैग किस राज्य का?", opts:["A) झारखंड","B) बिहार","C) पश्चिम बंगाल","D) छत्तीसगढ़"], ans:"C"},
      {q:"22. NPPA की पहली महिला निदेशक?", opts:["A) सब लॉरेंस जूलिया","B) कोर्केट केन्या देवावली","C) कोर्केट केन्या देवावली","D) शुभा सिंह"], ans:"D"},
      {q:"23. 'उद्योग क्रांति' किस राज्य ने शुरू की?", opts:["A) मध्य प्रदेश","B) पंजाब","C) महाराष्ट्र","D) हरियाणा"], ans:"B"},
      {q:"24. गुजरात के किस जिले में नया बौद्ध गुफा स्थल?", opts:["A) पी. किशोर कुमार सिंह","B) पी. विनोद कुमार","C) जे. एन. गणेश कुमार","D) पी. रविशंकर गुप्ता"], ans:"C"},
      {q:"25. वरिष्ठ नागरिक/विधवा/दिव्यांग पेंशन 400 से बढ़ाकर?", opts:["A) 800","B) 1400","C) 1000","D) 1600"], ans:"B"},
      {q:"26. योग नीति लागू करने वाला पहला राज्य?", opts:["A) उत्तर प्रदेश","B) बिहार","C) पंजाब","D) उत्तराखंड"], ans:"D"},
      {q:"27. CRC दर्जे हेतु कार्यकारी कार्यकलापों में 50% आरक्षण किस राज्य ने?", opts:["A) पश्चिम बंगाल","B) बिहार","C) असम","D) झारखंड"], ans:"C"},
      {q:"28. 2024 में दुनिया का सबसे बड़ा इस्पात निर्यातक कौन बना?", opts:["A) कोरिया","B) जर्मनी","C) चीन","D) रूस"], ans:"B"},
      {q:"29. भारतीय चुनाव सुधार 2025 - सत्य कथन?", opts:["A) केवल (i)","B) केवल (ii)","C) (i) और (ii) दोनों","D) इनमें से कोई नहीं"], ans:"A"},
      {q:"30. यूनेस्को 'क्रिएटिव सिटी' में शामिल भारतीय शहर?", opts:["A) मुंबई","B) पटना","C) कोल्लम","D) भोपाल"], ans:"C"},
      {q:"31. माइक्रोचिप को पीछे छोड़ सबसे मूल्यवान कंपनी?", opts:["A) इंफोसिस","B) एप्पल","C) रिलायंस","D) सारसको"], ans:"A"},
      {q:"32. इज़राइल का ईरान न्यूक्लियर साइट ऑपरेशन?", opts:["A) ऑपरेशन इनतेब्बे","B) ऑपरेशन राइजिंग लाइन","C) ऑपरेशन टू प्रॉमिस 3","D) ऑपरेशन ओवरलॉर्ड"], ans:"B"},
      {q:"33. MI-6 की पहली महिला प्रमुख?", opts:["A) ब्लेज मेट्रेवेली","B) बेदी बूथयार्ड","C) नस घानी","D) स्थालविया हिल"], ans:"A"},
      {q:"34. संयुक्त राष्ट्र महासभा ने 2026 को किस वर्ष के रूप में घोषित किया?", opts:["A) अंतर्राष्ट्रीय वैज्ञानिक वर्ष","B) अंतर्राष्ट्रीय महिला किसान वर्ष","C) अंतर्राष्ट्रीय नवाचार वर्ष","D) अंतर्राष्ट्रीय नर्स वर्ष"], ans:"B"},
      {q:"35. SDG सूचकांक 2025 में भारत का स्थान?", opts:["A) 95वाँ","B) 97वाँ","C) 99वाँ","D) 101वाँ"], ans:"C"},
      {q:"36. वैश्विक लैंगिक अंतराल सूचकांक 2025 में शीर्ष देश?", opts:["A) स्वीडन","B) नार्वे","C) डेनमार्क","D) आइसलैंड"], ans:"D"},
      {q:"37. 'नोमैडिक एलिफेंट 2025' (17वाँ संस्करण) किस देश के साथ?", opts:["A) मालदीव","B) मंगोलिया","C) थाइलैंड","D) वियतनाम"], ans:"B"},
      {q:"38. अमेरिका का ईरान परमाणु ठिकानों पर हमला ऑपरेशन?", opts:["A) टू प्रॉमिस 3","B) राइजिंग लाइन","C) मिडनाइट हैमर","D) इनतेब्बे"], ans:"C"},
      {q:"39. IPL में 300 छक्के लगाने वाले पहले भारतीय?", opts:["A) विराट कोहली","B) सूर्यकुमार यादव","C) रोहित शर्मा","D) हार्दिक पांड्या"], ans:"C"},
      {q:"40. ICC हॉल ऑफ फेम में शामिल भारतीय खिलाड़ी?", opts:["A) जहीर खान","B) हरभजन सिंह","C) मो. कैफ","D) महेन्द्र सिंह धोनी"], ans:"D"},
      {q:"41. ISSF वर्ल्ड कप म्यूनिख 10m एयर पिस्टल स्वर्ण (भारतीय महिला)?", opts:["A) मनु भाकर","B) सुरूचि सिंह","C) अंजलि भागवत","D) अपूर्वी चंदेला"], ans:"B"},
      {q:"42. टेस्ट की दोनों पारियों में शतक जमाने वाले भारतीय विकेटकीपर?", opts:["A) ईशान किशन","B) के.एल. राहुल","C) ऋषभ पंत","D) महेन्द्र सिंह धोनी"], ans:"C"},
      {q:"43. WTC 2025 का विजेता?", opts:["A) दक्षिण अफ्रीका","B) भारत","C) ऑस्ट्रेलिया","D) इंग्लैंड"], ans:"A"},
      {q:"44. स्टार्टअप महारथी चैलेंज के विषय (मुख्य आकर्षण)?", opts:["A) (i) और (ii)","B) (ii), (iii) और (iv)","C) (i), (iii) और (iv)","D) (ii) और (iv)"], ans:"B"},
      {q:"45. फ्रेंच ओपन 2025 पुरुष एकल विजेता?", opts:["A) कार्लोस अल्काराज","B) जैनिक सिनर","C) राफेल नडाल","D) रोजर फेडरर"], ans:"A"},
      {q:"46. IPL 2025 का खिताब किसने जीता?", opts:["A) पंजाब किंग्स","B) मुम्बई इंडियंस","C) सनराइजर्स हैदराबाद","D) रॉयल चैलेंजर्स बेंगलुरू"], ans:"D"},
      {q:"47. मिस वर्ल्ड 2025 (हैदराबाद) का खिताब?", opts:["A) मजा क्लाजदा","B) ओपल सुचाता चुआंगसरी","C) हसेट देरेजे","D) नंदनी गुप्ता"], ans:"B"},
      {q:"48. 'ह्यूमैनिटेरियन अवॉर्ड' से सम्मानित भारतीय अभिनेता?", opts:["A) सलमान खान","B) अक्षय कुमार","C) सोनू सूद","D) अमिताभ बच्चन"], ans:"C"},
      {q:"49. 'वंदे गंगा जल संरक्षण अभियान' किस राज्य ने शुरू किया?", opts:["A) हरियाणा","B) राजस्थान","C) मध्य प्रदेश","D) छत्तीसगढ़"], ans:"B"},
      {q:"50. CII का अध्यक्ष किसे नियुक्त किया गया?", opts:["A) एस महेन्द्र देव","B) अरुण श्रीनिवास","C) शैलेश सी. मेहता","D) राजीव मेमानी"], ans:"D"}
    ];
    // The above mapping follows the Answer Key embedded on the last page of the provided PDF attachment[1].

    // State
    let order = [...Array(QA.length).keys()];
    let current = 0;
    let answers = Array(QA.length).fill(null);
    let submitted = false;
    let timerId = null;
    let deadline = null;

    // DOM
    const qText = document.getElementById('qText');
    const optionsEl = document.getElementById('options');
    const qIndexEl = document.getElementById('qIndex');
    const progressEl = document.getElementById('progress');
    const totalCountEl = document.getElementById('totalCount');
    const reviewEl = document.getElementById('review');
    const correctTextEl = document.getElementById('correctText');
    const btnPrev = document.getElementById('btnPrev');
    const btnNext = document.getElementById('btnNext');
    const btnSave = document.getElementById('btnSave');
    const btnClear = document.getElementById('btnClear');
    const resultCard = document.getElementById('resultCard');
    const qCard = document.getElementById('qCard');
    const finalScore = document.getElementById('finalScore');
    const summaryLine = document.getElementById('summaryLine');
    const reviewList = document.getElementById('reviewList');
    const btnRestart = document.getElementById('btnRestart');
    const btnRetake = document.getElementById('btnRetake');
    const btnDownload = document.getElementById('btnDownload');
    const toggleTimer = document.getElementById('toggleTimer');
    const toggleShuffle = document.getElementById('toggleShuffle');
    const timerPill = document.getElementById('timerPill');

    function init() {
      totalCountEl.textContent = QA.length;
      // Load persisted attempt if present
      const saved = JSON.parse(localStorage.getItem('lan_exam_state') || 'null');
      if (saved && saved.Q === QA.length) {
        answers = saved.answers || answers;
        current = saved.current || 0;
        order = saved.order || order;
        submitted = !!saved.submitted;
      }
      render();
      if (submitted) showResults();
    }

    function persist() {
      localStorage.setItem('lan_exam_state', JSON.stringify({
        Q: QA.length, answers, current, order, submitted
      }));
    }

    function render() {
      const idx = order[current];
      const item = QA[idx];
      qText.textContent = item.q;
      qIndexEl.textContent = `प्रश्न ${current+1} / ${QA.length}`;
      progressEl.style.width = `${((current)/ (QA.length-1)) * 100}%`;
      optionsEl.innerHTML = '';
      reviewEl.classList.add('hidden');

      item.opts.forEach((opt, i) => {
        const optCode = ['A','B','C','D'][i];
        const div = document.createElement('label');
        div.className = 'opt';
        const input = document.createElement('input');
        input.type = 'radio';
        input.name = 'opt';
        input.value = optCode;
        input.checked = answers[idx] === optCode;
        const span = document.createElement('span');
        span.textContent = opt;
        div.appendChild(input);
        div.appendChild(span);
        if (answers[idx] === optCode) div.classList.add('selected');

        div.addEventListener('click', (e) => {
          answers[idx] = optCode;
          persist();
          renderSelectionStyles();
        });

        optionsEl.appendChild(div);
      });

      btnPrev.disabled = current === 0;
      btnNext.textContent = current === QA.length-1 ? (submitted ? 'Next' : 'Submit') : 'Next';
    }

    function renderSelectionStyles() {
      const idx = order[current];
      const children = [...optionsEl.children];
      children.forEach((el, i) => {
        const code = ['A','B','C','D'][i];
        el.classList.toggle('selected', answers[idx] === code);
      });
    }

    function next() {
      if (!submitted && current === QA.length-1) {
        // Submit
        submitExam();
        return;
      }
      if (current < QA.length-1) current++;
      render();
    }

    function prev() {
      if (current > 0) current--;
      render();
    }

    function clearChoice() {
      const idx = order[current];
      answers[idx] = null;
      persist();
      render();
    }

    function saveChoice() {
      persist();
      flash('Saved locally.');
    }

    function submitExam() {
      submitted = true;
      persist();
      showResults();
    }

    function scoreExam() {
      let correct = 0, attempted = 0;
      const details = [];
      order.forEach((idx, displayIdx) => {
        const item = QA[idx];
        const chosen = answers[idx];
        const isCorrect = chosen === item.ans;
        if (chosen) attempted++;
        if (isCorrect) correct++;
        details.push({display:displayIdx+1, q:item.q, chosen, ans:item.ans, isCorrect, opts:item.opts});
      });
      return {correct, attempted, total:QA.length, details};
    }

    function showResults() {
      const {correct, attempted, total, details} = scoreExam();
      qCard.classList.add('hidden');
      resultCard.classList.remove('hidden');
      finalScore.textContent = `${correct}/${total}`;
      summaryLine.textContent = `Attempted: ${attempted}/${total} • Skipped: ${total-attempted}`;
      reviewList.innerHTML = '';
      details.forEach(row => {
        const wrap = document.createElement('div');
        wrap.style.border = '1px solid #e5e7eb';
        wrap.style.borderRadius = '10px';
        wrap.style.padding = '10px';
        wrap.style.marginTop = '10px';
        const h = document.createElement('div');
        h.innerHTML = `<span class="badge">Q${row.display}</span> ${row.q}`;
        const ul = document.createElement('div');
        ul.style.display = 'grid';
        ul.style.gap = '8px';
        row.opts.forEach((t,i)=>{
          const code = ['A','B','C','D'][i];
          const li = document.createElement('div');
          li.className = 'opt';
          li.style.cursor = 'default';
          li.innerHTML = `<input type="radio" disabled ${row.chosen===code?'checked':''}/> <span>${t}</span>`;
          if (row.ans===code) li.classList.add('correct');
          if (row.chosen && row.chosen===code && row.ans!==code) li.classList.add('wrong');
          ul.appendChild(li);
        });
        const line = document.createElement('div');
        line.style.marginTop = '6px';
        line.innerHTML = row.isCorrect ? '<span class="success">सही</span>' :
          `<span class="danger">गलत</span> • सही उत्तर: <strong>${row.ans}</strong>`;
        wrap.appendChild(h); wrap.appendChild(ul); wrap.appendChild(line);
        reviewList.appendChild(wrap);
      });
      stopTimer(true);
    }

    function restart(clearStorage=false) {
      submitted = false;
      answers = Array(QA.length).fill(null);
      current = 0;
      order = [...Array(QA.length).keys()];
      if (config.shuffleQuestions || toggleShuffle.checked) shuffle(order);
      if (clearStorage) localStorage.removeItem('lan_exam_state'); else persist();
      resultCard.classList.add('hidden');
      qCard.classList.remove('hidden');
      render();
      stopTimer(true);
      if (toggleTimer.checked) startTimer();
    }

    function retake() { restart(false); }

    function downloadCSV() {
      const {details, correct, total} = scoreExam();
      const rows = [
        ['Q#','Question','Chosen','Correct','Result'],
        ...details.map(d=>[d.display, csvEscape(d.q), d.chosen||'', d.ans, d.isCorrect?'Correct':'Wrong']),
        [],
        ['Score', `${correct}/${total}`]
      ];
      const csv = rows.map(r=>r.map(csvCell).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'results.csv';
      a.click();
    }
    function csvEscape(s){ return (s||'').replace(/\n/g,' ').replace(/\s+/g,' ').trim(); }
    function csvCell(s){
      const t = String(s??'');
      return `"${t.replace(/"/g,'""')}"`;
    }

    function shuffle(arr){
      for (let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
      }
      return arr;
    }

    function flash(msg){
      const n = document.createElement('div');
      n.textContent = msg;
      n.style.position='fixed'; n.style.bottom='16px'; n.style.right='16px';
      n.style.background='#111827'; n.style.color='#fff'; n.style.padding='10px 12px';
      n.style.borderRadius='8px'; n.style.boxShadow='0 8px 20px rgba(0,0,0,.2)';
      document.body.appendChild(n);
      setTimeout(()=>n.remove(),1500);
    }

    // Timer
    function startTimer(){
      deadline = Date.now() + config.timerMinutes*60*1000;
      timerPill.textContent = `Timer: ${config.timerMinutes}m`;
      timerPill.classList.remove('hidden');
      stopTimer(true);
      tick();
      timerId = setInterval(tick, 1000);
    }
    function stopTimer(reset){
      if (timerId){ clearInterval(timerId); timerId = null; }
      if (reset){ timerPill.textContent = 'Timer: Off'; }
    }
    function tick(){
      const remain = Math.max(0, deadline - Date.now());
      const ms = Math.floor(remain/1000);
      const m = String(Math.floor(ms/60)).padStart(2,'0');
      const s = String(ms%60).padStart(2,'0');
      timerPill.textContent = `Timer: ${m}:${s}`;
      if (remain<=0){
        stopTimer();
        if (!submitted) submitExam();
      }
    }

    // Events
    btnNext.addEventListener('click', next);
    btnPrev.addEventListener('click', prev);
    btnSave.addEventListener('click', saveChoice);
    btnClear.addEventListener('click', clearChoice);
    btnRestart.addEventListener('click', ()=>restart(true));
    btnRetake.addEventListener('click', retake);
    btnDownload.addEventListener('click', downloadCSV);
    toggleTimer.addEventListener('change', (e)=>{
      if (e.target.checked){ startTimer(); } else { stopTimer(true); }
    });
    toggleShuffle.addEventListener('change', (e)=>{
      config.shuffleQuestions = e.target.checked;
      flash(config.shuffleQuestions?'Shuffle on':'Shuffle off');
    });

    // Apply initial shuffle based on config
    if (config.shuffleQuestions) shuffle(order);

    init();
  </script>
  <!-- Questions and answer key sourced from the attached PDF file's content and its final answer key page[1]. -->
</body>
</html>
