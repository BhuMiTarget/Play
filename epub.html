<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TCS Score Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f1724;
      color: #e6eef6;
      padding: 20px;
    }
    h1 { font-size: 20px; }
    input, button {
      padding: 8px;
      margin: 6px 0;
      border-radius: 6px;
      border: none;
    }
    input {
      width: 80%;
    }
    button {
      background: #06b6d4;
      color: #022;
      cursor: pointer;
    }
    pre {
      background: #0b1220;
      padding: 12px;
      border-radius: 6px;
      margin-top: 10px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>TCS Score Calculator</h1>
  <p>Enter your TCS review page URL below and click <b>Calculate</b>.  
     (You must be logged in to the portal in this same browser for it to work.)</p>
  <input type="text" id="url" placeholder="Paste TCS review page URL here" />
  <br>
  <button onclick="runCalc()">Calculate</button>

  <pre id="output">Result will appear here...</pre>

<script>
async function runCalc() {
  const url = document.getElementById('url').value.trim();
  if(!url) {
    alert("Please enter the review page URL");
    return;
  }

  try {
    const resp = await fetch(url, {credentials: "include"});
    const html = await resp.text();

    // Create a hidden DOM parser
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, "text/html");

    let totalMarks=0;
    let resultText="";

    for(let s=0;s<4;s++){
      let right=0,notAttempted=0,bonus=0;
      for(let i=25*s;i<25*s+25;i++){
        const pnl = doc.getElementsByClassName("question-pnl")[i];
        if(!pnl) continue;
        const chosen = pnl.getElementsByClassName("bold")[5]?.textContent.trim();
        if(chosen === "--") notAttempted++;
        try {
          const correct = pnl.getElementsByClassName("rightAns")[0].textContent.trim()[0];
          if(correct === chosen) right++;
        } catch {
          bonus++;
        }
      }
      const wrong = 25 - notAttempted - right - bonus;
      const marks = 2*(right+bonus) - 0.5*wrong;
      totalMarks += marks;
      resultText += `Subject ${s+1}:\nAttempted: ${25-notAttempted}\nRight: ${right}\nWrong: ${wrong}\nBonus: ${bonus}\nMarks: ${marks}\n\n`;
    }
    resultText += "============================\n";
    resultText += "Total Marks: " + totalMarks;

    document.getElementById('output').textContent = resultText;
  } catch (err) {
    document.getElementById('output').textContent = "Error fetching or parsing page. Make sure you're logged in and the URL is correct.\n\n" + err;
  }
}
</script>
</body>
</html>
